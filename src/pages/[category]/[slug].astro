---
import { getCollection } from "astro:content";
import { allCategories, categoryMeta, GardenCategory } from "@/lib/categories";
import Layout from "@/layouts/Layout.astro";
import BreadcrumbNav from "@/components/BreadcrumbNav.astro";

export async function getStaticPaths() {
  const allPaths = await Promise.all(
    allCategories.map(async (category) => {
      const entries = await getCollection(category as GardenCategory);
      return entries.map((entry) => ({
        params: {
          category,
          slug: entry.slug,
        },
        props: { entry, category, slug: entry.slug }, // <- ici
      }));
    })
  );

  return allPaths.flat();
}

const { entry, category, slug } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={"test"}>
  <article class="mx-auto">
    <section class="flex flex-row items-center gap-4">
      <h2 class="text-4xl font-extrabold">{entry.data.title}</h2>
    </section>
    <section class="mt-4 mb-8">
      <BreadcrumbNav
        items={[
          { label: "Home", href: "/" },
          { label: categoryMeta[category].label, href: `/${category}` },
          { label: entry.data.title, href: `/${category}/${slug}` },
        ]}
      />
    </section>
    <div class="hero-image mt-7">
      {
        entry.data.heroImage && (
          <img
            width="100%"
            height={510}
            src={entry.data.heroImage}
            alt=""
            class="w-full h-auto rounded-md my-7"
          />
        )
      }
    </div>
    <div class="prose dark:prose-invert w-full">
      <Content />
    </div>
  </article>
</Layout>
