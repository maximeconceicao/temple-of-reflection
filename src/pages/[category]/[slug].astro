---
import { getCollection } from "astro:content";
import { allCategories, categoryMeta, GardenCategory } from "@/lib/categories";
import Layout from "@/layouts/Layout.astro";
import BreadcrumbNav from "@/components/BreadcrumbNav.astro";
import type { GardenEntry } from "@/lib/types";

export async function getStaticPaths() {
  const allPaths = await Promise.all(
    allCategories.map(async (category) => {
      const entries = await getCollection(category as GardenCategory);
      return entries.map((entry) => ({
        params: {
          category,
          slug: entry.slug,
        },
        props: { entry, category, slug: entry.slug }, // <- ici
      }));
    })
  );

  return allPaths.flat();
}

interface Props {
  entry: GardenEntry;
  category: GardenCategory;
  slug: string;
}

const { entry, category, slug } = Astro.props as Props;
const { Content, headings } = await entry.render();

const Icon = categoryMeta[category].icon;
---

<Layout title={entry.data.title} toc={headings} category={category}>
  <article class="mx-auto">
    <section class="flex flex-row items-center gap-2">
        <Icon
            className="w-10 h-10"
            style={{ stroke: `var(--${categoryMeta[category].color})` }}
          />
      <h2 class="text-4xl font-semibold">{entry.data.title}</h2>
    </section>
    <section class="mt-4 mb-8">
      <BreadcrumbNav
        items={[
          { label: "Home", href: import.meta.env.BASE_URL },
          { label: categoryMeta[category].label, href: `${import.meta.env.BASE_URL}${category}` },
          { label: entry.data.title, href: `${import.meta.env.BASE_URL}${category}/${slug}` },
        ]}
      />
    </section>
    <div class="hero-image mt-7">
      {
        entry.data.heroImageDark && entry.data.heroImageLight && (
          <img
        src={import.meta.env.BASE_URL + entry.data.heroImageLight}
        alt=""
        class="block dark:hidden w-full h-auto rounded-md my-7"
      />
      <img
        src={import.meta.env.BASE_URL + entry.data.heroImageDark}
        alt=""
        class="hidden dark:block w-full h-auto rounded-md my-7"
      />
        )
      }
    </div>
    <div class="prose dark:prose-invert max-w-none w-full">
      <Content />
    </div>
  </article>
</Layout>
